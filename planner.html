<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JEE/NEET Planner ‚Äî Powered by AKT.Ayush</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <style>
    :root{
      --pink:#ff4d6d; --pink-2:#ff758c; --pink-3:#ffe0e8; --ink:#111;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:15px;
      font-family:'Roboto',sans-serif; font-weight:900; color:#222;
      background:linear-gradient(135deg,var(--pink),var(--pink-2));
      display:flex; justify-content:center;
    }
    .container{
      width:100%; max-width:1200px;
      background:#fff; border-radius:18px; padding:20px;
      box-shadow:0 8px 24px rgba(0,0,0,.25);
    }
    h1,h2,h3{margin:6px 0; text-align:center; font-weight:900}
    h1{color:#d90429}
    h2{color:#d90429; font-size:16px}
    h3{color:#000000;font: aize 22px; }
    /* Date strip */
    .date-bar{
      margin-top:10px; margin-bottom:6px;
      background:linear-gradient(90deg,#ff5b78,#ff8aa1);
      color:#000000; border-radius:12px; padding:10px 14px;
      display:flex; align-items:center; justify-content:center; gap:10px;
      font-weight:900;font-size: 22px;
      box-shadow:0 4px 12px rgba(0,0,0,.15);
    }
    .date-chip{
      background:rgba(255,255,255,.18);
      padding:6px 10px; border-radius:999px; font-size:20px;
      backdrop-filter: blur(2px);
    }

    .table-wrapper{ overflow-x:auto; margin-top:12px }
    table{
      width:100%; border-collapse:collapse; min-width:700px;
    }
    th,td{
      border:2px solid var(--pink); padding:6px; text-align:center; vertical-align:top;
    }
    thead th{
      background:var(--pink-3); position:sticky; top:0; z-index:1; color:#b8003c;
      font-weight:900;
    }
    textarea{
      width:95%; min-height:30px; padding:6px; resize:none; overflow:hidden;
      border:2px solid var(--pink); border-radius:6px; background:hsl(0, 0%, 100%);
      font-family:'Roboto',sans-serif; font-weight:700; font-size:14px; text-align:center;
    }
    .timeInput{
      width:180px; padding:4px; border:2px solid var(--pink); border-radius:6px;
      background:#fff7f9; text-align:center; font-weight:900; font-size:14px; color:var(--ink);
    }
    input[type="checkbox"]{ transform:scale(1.2); accent-color:#00e1ff; }

    .btns{
      display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:16px;
    }
    button{
      padding:10px 16px; border:none; border-radius:10px; cursor:pointer;
      background:rgb(111, 255, 74); color:#fff; font-weight:900; font-size:14px;
      box-shadow:0 4px 12px rgba(0,0,0,.2); transition:.2s;
    }
    button:hover{ background:#d90429; transform:translateY(-1px) }

    @media (max-width:768px){
      h1{font-size:20px} h2{font-size:14px}
      .timeInput{width:76px; font-size:12px}
      textarea{font-size:12px}
      button{font-size:12px; padding:8px 12px}
    }
  </style>
</head>
<body>
    <div class="container" id="planner">
    <h1>üìò JEE / NEET Daily Planner</h1>
    <h2>Powered by AKT.Ayush</h2>
    <h3 id="welcome"></h3>
    <h4 id="todayDate"></h4>

    <!-- Date strip -->
    <div class="date-bar">
      <div class="date-chip" id="dayChip">‚Äî</div>
      <div id="dateString">‚Äî</div>
    </div>

    <div class="table-wrapper">
      <table id="plannerTable">
        <thead>
          <tr>
            <th>Select</th>
            <th>Time</th>
            <th>To Do</th>
            <th>Important Note</th>
            <th>Completed</th>
            <th>Feedback</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="btns">
      <button id="addRow">‚ûï Add Row</button>
      <button id="mergeRows">üîó Merge Selected</button>
      <button id="unmergeRows">‚ùå Unmerge</button>
      <button id="resetTable">‚ôª Reset</button>
      <button id="savePdf">üì• Save as PDF (A4 Portrait)</button>
    </div>
  </div>

  <script>
    // Show student name
    const studentName = localStorage.getItem("studentName") || "Student";
    document.getElementById("welcome").innerText = `Welcome, ${studentName} üëã`;

    // ---- Date strip (India locale-friendly)
    const now = new Date();
    document.getElementById("dayChip").textContent =
      now.toLocaleDateString("en-IN", { weekday: "long" });
    document.getElementById("dateString").textContent =
      now.toLocaleDateString("en-IN", { day:"2-digit", month:"long", year:"numeric" });

    // ---- Table logic
    const tbody = document.querySelector("#plannerTable tbody");

    function generateRows(){
      tbody.innerHTML = "";
      for(let i=0;i<24;i++){
        addRow(String(i).padStart(2,"0")+":00");
      }
    }

    function addRow(time=""){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input type="checkbox" class="rowSelect"></td>
        <td><input type="text" class="timeInput" value="${time}"></td>
        <td><textarea placeholder="Task"></textarea></td>
        <td><textarea placeholder="Note"></textarea></td>
        <td><input type="checkbox"></td>
        <td><textarea placeholder="Feedback"></textarea></td>
      `;
      tbody.appendChild(tr);
      enableAutoResize(tr);
    }

    function autoResize(el){
      el.style.height = "auto";
      el.style.height = el.scrollHeight + "px";
    }
    function enableAutoResize(scope=document){
      scope.querySelectorAll("textarea").forEach(t=>{
        t.addEventListener("input", ()=>autoResize(t));
        autoResize(t);
      });
    }

    // Merge (creates editable time range + combines texts)
    document.getElementById("mergeRows").addEventListener("click", ()=>{
      const selected = [...document.querySelectorAll(".rowSelect:checked")].map(cb=>cb.closest("tr"));
      if(selected.length < 2){ alert("Select at least 2 rows to merge!"); return; }

      const startTime = selected[0].querySelector(".timeInput").value || "??:??";
      const endTime = selected[selected.length-1].querySelector(".timeInput").value || "??:??";
      const range = `${startTime} - ${endTime}`;

      let mergedTask="", mergedNote="", mergedFeedback="";
      selected.forEach((row,i)=>{
        const [task, note, feed] = row.querySelectorAll("textarea");
        mergedTask += (task?.value || "") + (i < selected.length-1 ? " | " : "");
        mergedNote += (note?.value || "") + (i < selected.length-1 ? " | " : "");
        mergedFeedback += (feed?.value || "") + (i < selected.length-1 ? " | " : "");
      });

      const top = selected[0];
      top.querySelector(".timeInput").value = range;
      const [t1,n1,f1] = top.querySelectorAll("textarea");
      t1.value = mergedTask; n1.value = mergedNote; f1.value = mergedFeedback;
      [t1,n1,f1].forEach(autoResize);
      top.dataset.mergedRange = `${startTime},${endTime}`;

      // remove the rest
      selected.slice(1).forEach(r=>r.remove());
    });

    // Unmerge (restores rows for the saved range)
    document.getElementById("unmergeRows").addEventListener("click", ()=>{
      const rows = [...document.querySelectorAll("#plannerTable tbody tr")];
      let found = false;

      rows.forEach(row=>{
        const cb = row.querySelector(".rowSelect");
        if(cb.checked && row.dataset.mergedRange){
          found = true;
          const [startTime,endTime] = row.dataset.mergedRange.split(",");
          const startH = parseInt(startTime.split(":")[0]);
          const endH = parseInt(endTime.split(":")[0]);

          const [taskVal, noteVal, feedVal] = row.querySelectorAll("textarea");
          row.remove();

          for(let h=startH; h<=endH; h++){
            const hour = String(h).padStart(2,"0")+":00";
            addRow(hour);
            const newRow = tbody.lastElementChild;
            const [t,n,f] = newRow.querySelectorAll("textarea");
            t.value = taskVal.value; n.value = noteVal.value; f.value = feedVal.value;
            [t,n,f].forEach(autoResize);
          }
        }
      });

      if(!found) alert("Select a merged row to unmerge!");
    });

    document.getElementById("addRow").addEventListener("click", ()=>addRow(""));
    document.getElementById("resetTable").addEventListener("click", generateRows);

    // PDF (A4 Portrait)
    document.getElementById("savePdf").addEventListener("click", ()=>{
      const el = document.getElementById("planner");
      const opt = {
        margin: 0.3,
        filename: "AKT_Planner.pdf",
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2, useCORS:true },
        jsPDF: { unit: "in", format: "a4", orientation: "portrait" }
      };
      html2pdf().set(opt).from(el).save();
    });

    // Init
    generateRows();
  </script>
</body>
</html>